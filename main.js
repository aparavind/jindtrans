"use strict";

const usubstr = require('unicode-substring');
const ulength = require('unicode-length');


document.getElementById('response').innerHTML = ulength.get('üí•Emoji Ruleüí•');

function transliterate(string,origLang,finalLang){
    var greatArray = {
        "oM": {
          "opDvn": "‡•ê",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "t": {
          "opDvn": "‡§§‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "a[%% e %%]": {
          "opDvn": "",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "aa[%% e %%]": {
          "opDvn": "‡§æ",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "A[%% e %%]": {
          "opDvn": "‡§æ",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "i[%% e %%]": {
          "opDvn": "‡§ø",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "I[%% e %%]": {
          "opDvn": "‡•Ä",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "ee[%% e %%]": {
          "opDvn": "‡•Ä",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "u[%% e %%]": {
          "opDvn": "‡•Å",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "U[%% e %%]": {
          "opDvn": "‡•Ç",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "Ru[%% e %%]": {
          "opDvn": "‡•É",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "RU[%% e %%]": {
          "opDvn": "‡•Ñ",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "~lu[%% e %%]": {
          "opDvn": "‡•¢",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "~lU[%% e %%]": {
          "opDvn": "‡•£",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "~e[%% e %%]": {
          "opDvn": "‡•Ö",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "~a[%% e %%]": {
          "opDvn": "‡•Ö",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "oo[%% e %%]": {
          "opDvn": "‡•Ç",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "e[%% e %%]": {
          "opDvn": "‡•á",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "E[%% e %%]": {
          "opDvn": "‡•Ü",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "ai[%% e %%]": {
          "opDvn": "‡•à",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "~o[%% e %%]": {
          "opDvn": "‡•â",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "o[%% e %%]": {
          "opDvn": "‡•ã",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "au[%% e %%]": {
          "opDvn": "‡•å",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "ou[%% e %%]": {
          "opDvn": "‡•å",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 1,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "~M": {
          "opDvn": "‡§Å",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "M": {
          "opDvn": "‡§Ç",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 1
        },
        "H": {
          "opDvn": "‡§É",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": ""
        },
        "a": {
          "opDvn": "‡§Ö",
          "isLast": 0,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "A": {
          "opDvn": "‡§Ü",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "aa": {
          "opDvn": "‡§Ü",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "i": {
          "opDvn": "‡§á",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "I": {
          "opDvn": "‡§à",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "ee": {
          "opDvn": "‡§à",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "u": {
          "opDvn": "‡§â",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "U": {
          "opDvn": "‡§ä",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "Ru": {
          "opDvn": "‡§ã",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "RU": {
          "opDvn": "‡•†",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "~lu": {
          "opDvn": "‡§å",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "~lU": {
          "opDvn": "‡•°",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "~e": {
          "opDvn": "‡§ç",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "~a": {
          "opDvn": "‡•≤",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "oo": {
          "opDvn": "‡§ä",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "e": {
          "opDvn": "‡§è",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "E": {
          "opDvn": "‡§é",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "ai": {
          "opDvn": "‡§ê",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "~o": {
          "opDvn": "‡§ë",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "au": {
          "opDvn": "‡§î",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "ou": {
          "opDvn": "‡§î",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "o": {
          "opDvn": "‡§ì",
          "isLast": 1,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 1,
          "independantInvalid": 0
        },
        "k": {
          "opDvn": "‡§ï‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "kh": {
          "opDvn": "‡§ñ‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "K": {
          "opDvn": "‡§ñ‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "g": {
          "opDvn": "‡§ó‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "gh": {
          "opDvn": "‡§ò‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "G": {
          "opDvn": "‡§ò‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "~g": {
          "opDvn": "‡§ô‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "c": {
          "opDvn": "‡§ö‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "ch": {
          "opDvn": "‡§õ‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "C": {
          "opDvn": "‡§õ‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "j": {
          "opDvn": "‡§ú‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "J": {
          "opDvn": "‡§ù‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "jh": {
          "opDvn": "‡§ù‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "~j": {
          "opDvn": "‡§û‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "T": {
          "opDvn": "‡§ü‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "Th": {
          "opDvn": "‡§†‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "D": {
          "opDvn": "‡§°‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "Dh": {
          "opDvn": "‡§¢‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "N": {
          "opDvn": "‡§£‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "th": {
          "opDvn": "‡§•‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "d": {
          "opDvn": "‡§¶‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "dh": {
          "opDvn": "‡§ß‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "n": {
          "opDvn": "‡§®‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "nx": {
          "opDvn": "‡§©‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "p": {
          "opDvn": "‡§™‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "ph": {
          "opDvn": "‡§´‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "b": {
          "opDvn": "‡§¨‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "bh": {
          "opDvn": "‡§≠‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "m": {
          "opDvn": "‡§Æ‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "y": {
          "opDvn": "‡§Ø‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "r": {
          "opDvn": "‡§∞‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "rx": {
          "opDvn": "‡§±‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "l": {
          "opDvn": "‡§≤‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "L": {
          "opDvn": "‡§≥‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "Lx": {
          "opDvn": "‡§¥‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "v": {
          "opDvn": "‡§µ‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "w": {
          "opDvn": "‡§µ‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "S": {
          "opDvn": "‡§∂‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "sh": {
          "opDvn": "‡§∂‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "Sh": {
          "opDvn": "‡§∑‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "s": {
          "opDvn": "‡§∏‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "h": {
          "opDvn": "‡§π‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "~h": {
          "opDvn": "‡§π‡•ç",
          "isLast": 0,
          "isMinussable": 1,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 0
        },
        "q": {
          "opDvn": "‡•í",
          "isLast": 0,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "Q": {
          "opDvn": "·≥í",
          "isLast": 0,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "V": {
          "opDvn": "·≥ù",
          "isLast": 0,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "W": {
          "opDvn": "dot above",
          "isLast": 0,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "#": {
          "opDvn": "‡•ë",
          "isLast": 0,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 1
        },
        "$": {
          "opDvn": "·≥ö",
          "isLast": 0,
          "isMinussable": 0,
          "performMinusOne": 0,
          "existAnother": 0,
          "independantInvalid": 1
        }
      };
	var detClass = {
        "brhMaxSize" : 8,
        "previousMinussable" : 0
    };
	detClass = next_conv_char(0,0,detClass,1);

	var offset = 0;
	var loopString = string;
	var outString = "";
	do {
        detClass.removeLastChar = 0;
        detClass.i = 0;
		detClass = next_conv_char(greatArray,loopString,detClass,0);
		if (detClass.i == 0){
			break;
		}

		if (detClass.removeLastChar == 1){
			outString = removeLastChar(outString,detClass);
		}
		
		outString = outString + detClass.outStr;
		loopString = usubstr(loopString,detClass.i);
	
    } while (1);
    return outString;
  }

function removeLastChar(outString,detClass){
	var len = ulength.get(outString);
	return usubstr(outString,0,len-1);
}

function next_conv_char(greatArray,inpString,detClass,resetAll){

    if (resetAll == 1){
        detClass.previousMinussable = 0;
        detClass.outputStatus = 0;
        return detClass;
    }

    if (inpString == ""){
        detClass.outputStatus = 0;
        return detClass;       
    }

    var getI = getMatchingI(inpString,detClass.previousMinussable,greatArray,detClass);

    if ((getI.i == 0) && (detClass.previousMinussable == 1)){
        getI = getMatchingI(inpString,0,greatArray,detClass);
    }

    if (getI.i >0){
        detClass.outStr = getI.greatA.opDvn;
	    detClass.removeLastChar = getI.greatA.performMinusOne && detClass.previousMinussable;
	    detClass.previousMinussable = getI.greatA.isMinussable;
    } else {
	    detClass.outStr = usubstr(inpString,0,1);
	    getI.i = getI.i + 1;
    }
    detClass.i = getI.i;
    return detClass;
}

function getMatchingI(inpString,hasMinus,greatArray,detClass){
    var ret = {};
    var l = ulength.get(inpString);
    for(var i= (detClass.brhMaxSize > l) ? l:detClass.brhMaxSize ; i > 0; i--){
        var subString = usubstr(inpString,0,i);
        if (hasMinus){
            subString = subString + "[%% e %%]";
        }
        if (greatArray[subString]){
            break;
        }
    }
    ret.i = i;
    if (i > 0){
        ret.greatA = greatArray[subString];
    }
    return ret;
}




  
 console.log(transliterate("agnimeeLe purohitaM"));

